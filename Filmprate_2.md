# Улучшение Filmorate

## Описание задачи

Настало время улучшить **Filmorate**. Для составления рейтинга фильмов нужны отзывы пользователей, а для улучшения рекомендаций — объединение пользователей в комьюнити.

По итогам прошлого спринта у вас получилась заготовка приложения, которое может принимать, обновлять и возвращать пользователей и фильмы. В этот раз:
- Улучшим API до соответствия REST.
- Изменим архитектуру приложения с помощью внедрения зависимостей.

## Порядок действий

### 1. Наводим порядок в репозитории

1. Убедитесь, что ваша работа за предыдущий спринт слита с главной веткой `main`.
2. Создайте новую ветку под названием `add-friends-likes`.

### Подсказка: работа в Git

Для слияния веток используйте команду `merge`.

---

## Архитектура

### 2. Переработка архитектуры

Сейчас вся логика приложения находится в контроллерах — изменим это. Вынесем хранение данных о фильмах и пользователях в отдельные классы — **хранилища** (англ. `storage`).

### 3. Создаём интерфейсы и классы

- Создайте интерфейсы `FilmStorage` и `UserStorage`, содержащие методы добавления, удаления и модификации объектов.
- Реализуйте интерфейсы в классах `InMemoryFilmStorage` и `InMemoryUserStorage`, куда перенесите всю логику хранения, обновления и поиска объектов.
- Добавьте к классам аннотацию `@Component` для внедрения зависимостей.

### Подсказка: структура проекта

Создайте новый пакет `storage`, где будут храниться только классы и интерфейсы, относящиеся к хранению данных.

---

## Новая логика

### 4. Добавление бизнес-логики

Теперь добавим функциональность для взаимодействия пользователей и фильмов:
- Пользователи смогут добавлять друг друга в друзья.
- Каждый пользователь сможет лайкать фильмы.

### 5. Создание сервисов

- Создайте `UserService` для операций с пользователями (добавление/удаление друзей, вывод общего списка друзей).
- Создайте `FilmService` для операций с фильмами (добавление/удаление лайков, вывод 10 наиболее популярных фильмов).
- Добавьте к классам аннотацию `@Service`.

### Подсказка: структура проекта

Создайте пакет `service`, где будет храниться вся бизнес-логика приложения.

### Подсказка: хранение друзей и лайков

Для хранения друзей используйте `Set<Long>` с id друзей. Аналогично, используйте `Set<Long>` для лайков к фильмам.

---

## Внедрение зависимостей

### 6. Используйте внедрение зависимостей

Переделайте код в контроллерах, сервисах и хранилищах, используя аннотации `@Service`, `@Component`, `@Autowired`. Внедряйте зависимости через конструкторы классов. Убедитесь, что сервисы зависят от интерфейсов классов-хранилищ, а не их реализаций.

---

## Полный REST

### 7. Доведение API до REST

Добавьте аннотации `@PathVariable` для работы с уникальными идентификаторами фильмов и пользователей.

### 8. Операции с пользователями и фильмами

- **Добавление в друзья:**  
  `PUT /users/{id}/friends/{friendId}`
- **Удаление из друзей:**  
  `DELETE /users/{id}/friends/{friendId}`
- **Список друзей:**  
  `GET /users/{id}/friends`
- **Общие друзья:**  
  `GET /users/{id}/friends/common/{otherId}`
- **Лайк фильму:**  
  `PUT /films/{id}/like/{userId}`
- **Удаление лайка:**  
  `DELETE /films/{id}/like/{userId}`
- **Популярные фильмы:**  
  `GET /films/popular?count={count}`  
  Если `count` не задан, возвращается топ 10 фильмов.

---

## Обработка ошибок

### 9. Возвращаем корректные HTTP-коды

- `400` — ошибка валидации (`ValidationException`)
- `404` — объект не найден
- `500` — внутреннее исключение

### Подсказка: обработка ошибок

Настройте `ExceptionHandler` для централизованной обработки ошибок.
